function TimeSeries(options){options=options||{};options.resetBoundsInterval=options.resetBoundsInterval||3000;options.resetBounds=options.resetBounds===undefined?true:options.resetBounds;this.options=options;this.data=[];this.maxValue=Number.NaN;this.minValue=Number.NaN;if(options.resetBounds){this.boundsTimer=setInterval((function(thisObj){return function(){thisObj.resetBounds();}})(this),options.resetBoundsInterval);}}
TimeSeries.prototype.resetBounds=function(){this.maxValue=Number.NaN;this.minValue=Number.NaN;for(var i=0;i<this.data.length;i++){this.maxValue=!isNaN(this.maxValue)?Math.max(this.maxValue,this.data[i][1]):this.data[i][1];this.minValue=!isNaN(this.minValue)?Math.min(this.minValue,this.data[i][1]):this.data[i][1];}};TimeSeries.prototype.append=function(timestamp,value){this.data.push([timestamp,value]);this.maxValue=!isNaN(this.maxValue)?Math.max(this.maxValue,value):value;this.minValue=!isNaN(this.minValue)?Math.min(this.minValue,value):value;};function SmoothieChart(options){options=options||{};options.grid=options.grid||{};options.grid.fillStyle=options.grid.fillStyle||'#000000';options.grid.strokeStyle=options.grid.strokeStyle||'#777777';options.grid.lineWidth=typeof(options.grid.lineWidth)==='undefined'?1:options.grid.lineWidth;options.grid.sharpLines=!!options.grid.sharpLines;options.grid.millisPerLine=options.grid.millisPerLine||1000;options.grid.verticalSections=typeof(options.grid.verticalSections)==='undefined'?2:options.grid.verticalSections;options.millisPerPixel=options.millisPerPixel||20;options.maxValueScale=options.maxValueScale||1;options.labels=options.labels||{fillStyle:'#ffffff'};options.interpolation=options.interpolation||"bezier";options.scaleSmoothing=options.scaleSmoothing||0.125;options.maxDataSetLength=options.maxDataSetLength||2;options.timestampFormatter=options.timestampFormatter||null;options.horizontalLines=options.horizontalLines||[];this.options=options;this.seriesSet=[];this.currentValueRange=1;this.currentVisMinValue=0;}
SmoothieChart.AnimateCompatibility=(function(){var lastTime=0,requestAnimationFrame=function(callback,element){var requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){var currTime=new Date().getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;};return requestAnimationFrame.call(window,callback,element);},cancelAnimationFrame=function(id){var cancelAnimationFrame=window.cancelAnimationFrame||function(id){clearTimeout(id);};return cancelAnimationFrame.call(window,id);};return{requestAnimationFrame:requestAnimationFrame,cancelAnimationFrame:cancelAnimationFrame};})();SmoothieChart.prototype.addTimeSeries=function(timeSeries,options){this.seriesSet.push({timeSeries:timeSeries,options:options||{}});};SmoothieChart.prototype.removeTimeSeries=function(timeSeries){this.seriesSet.splice(this.seriesSet.indexOf(timeSeries),1);};SmoothieChart.prototype.streamTo=function(canvas,delay){this.canvas=canvas;this.delay=delay;this.start();};SmoothieChart.prototype.start=function(){if(!this.frame){this.animate();}};SmoothieChart.prototype.animate=function(){this.frame=SmoothieChart.AnimateCompatibility.requestAnimationFrame(this.animate.bind(this));this.render(this.canvas,new Date().getTime()-(this.delay||0));};SmoothieChart.prototype.stop=function(){if(this.frame){SmootheiChart.AnimateCompatibility.cancelAnimationFrame(this.frame);delete this.frame;}};SmoothieChart.timeFormatter=function(dateObject){function pad2(number){return(number<10?'0':'')+number};return pad2(dateObject.getHours())+':'+pad2(dateObject.getMinutes())+':'+pad2(dateObject.getSeconds());};SmoothieChart.prototype.render=function(canvas,time){var canvasContext=canvas.getContext("2d");var options=this.options;var dimensions={top:0,left:0,width:canvas.clientWidth,height:canvas.clientHeight};canvasContext.save();time=time-time%options.millisPerPixel;canvasContext.translate(dimensions.left,dimensions.top);canvasContext.beginPath();canvasContext.rect(0,0,dimensions.width,dimensions.height);canvasContext.clip();canvasContext.save();canvasContext.fillStyle=options.grid.fillStyle;canvasContext.clearRect(0,0,dimensions.width,dimensions.height);canvasContext.fillRect(0,0,dimensions.width,dimensions.height);canvasContext.restore();canvasContext.save();canvasContext.lineWidth=options.grid.lineWidth;canvasContext.strokeStyle=options.grid.strokeStyle;if(options.grid.millisPerLine>0){for(var t=time-(time%options.grid.millisPerLine);t>=time-(dimensions.width*options.millisPerPixel);t-=options.grid.millisPerLine){canvasContext.beginPath();var gx=Math.round(dimensions.width-((time-t)/options.millisPerPixel));if(options.grid.sharpLines)
gx-=0.5;canvasContext.moveTo(gx,0);canvasContext.lineTo(gx,dimensions.height);canvasContext.stroke();if(options.timestampFormatter){var tx=new Date(t);var ts=options.timestampFormatter(tx);var txtwidth=(canvasContext.measureText(ts).width/2)+canvasContext.measureText(minValueString).width+4;if(gx<dimensions.width-txtwidth){canvasContext.fillStyle=options.labels.fillStyle;canvasContext.fillText(ts,gx-(canvasContext.measureText(ts).width/2),dimensions.height-2);}}
canvasContext.closePath();}}
for(var v=1;v<options.grid.verticalSections;v++){var gy=Math.round(v*dimensions.height/options.grid.verticalSections);if(options.grid.sharpLines)
gy-=0.5;canvasContext.beginPath();canvasContext.moveTo(0,gy);canvasContext.lineTo(dimensions.width,gy);canvasContext.stroke();canvasContext.closePath();}
canvasContext.beginPath();canvasContext.strokeRect(0,0,dimensions.width,dimensions.height);canvasContext.closePath();canvasContext.restore();var maxValue=Number.NaN;var minValue=Number.NaN;for(var d=0;d<this.seriesSet.length;d++){var timeSeries=this.seriesSet[d].timeSeries;if(!isNaN(timeSeries.maxValue)){maxValue=!isNaN(maxValue)?Math.max(maxValue,timeSeries.maxValue):timeSeries.maxValue;}
if(!isNaN(timeSeries.minValue)){minValue=!isNaN(minValue)?Math.min(minValue,timeSeries.minValue):timeSeries.minValue;}}
if(isNaN(maxValue)&&isNaN(minValue)){canvasContext.restore();return;}
if(options.maxValue!=null)
maxValue=options.maxValue;else
maxValue=maxValue*options.maxValueScale;if(options.minValue!=null)
minValue=options.minValue;if(this.yRangeFunction){var range=this.yRangeFunction({min:minValue,max:maxValue});minValue=range.min;maxValue=range.max;}
var targetValueRange=maxValue-minValue;this.currentValueRange+=options.scaleSmoothing*(targetValueRange-this.currentValueRange);this.currentVisMinValue+=options.scaleSmoothing*(minValue-this.currentVisMinValue);var valueRange=this.currentValueRange;var visMinValue=this.currentVisMinValue;var yValueToPixel=function(value)
{var offset=value-visMinValue;return dimensions.height-(valueRange!==0?Math.round((offset/valueRange)*dimensions.height):0);};if(options.horizontalLines&&options.horizontalLines.length){for(var hl=0;hl<options.horizontalLines.length;hl++){var line=options.horizontalLines[hl];var hly=Math.round(yValueToPixel(line.value))-0.5;canvasContext.strokeStyle=line.color||'#ffffff';canvasContext.lineWidth=line.lineWidth||1;canvasContext.beginPath();canvasContext.moveTo(0,hly);canvasContext.lineTo(dimensions.width,hly);canvasContext.stroke();canvasContext.closePath();}}
for(var d=0;d<this.seriesSet.length;d++){canvasContext.save();var timeSeries=this.seriesSet[d].timeSeries;var dataSet=timeSeries.data;var seriesOptions=this.seriesSet[d].options;while(dataSet.length>=options.maxDataSetLength&&dataSet[1][0]<time-(dimensions.width*options.millisPerPixel)){dataSet.splice(0,1);}
canvasContext.lineWidth=seriesOptions.lineWidth||1;canvasContext.strokeStyle=seriesOptions.strokeStyle||'#ffffff';canvasContext.beginPath();var firstX=0,lastX=0,lastY=0;for(var i=0;i<dataSet.length&&dataSet.length!==1;i++){var x=Math.round(dimensions.width-((time-dataSet[i][0])/options.millisPerPixel));var y=yValueToPixel(dataSet[i][1]);if(i==0){firstX=x;canvasContext.moveTo(x,y);}
else{switch(options.interpolation){case"line":canvasContext.lineTo(x,y);break;case"bezier":default:canvasContext.bezierCurveTo(Math.round((lastX+x)/2),lastY,Math.round((lastX+x))/2,y,x,y);break;}}
lastX=x;lastY=y;}
if(dataSet.length>0&&seriesOptions.fillStyle){canvasContext.lineTo(dimensions.width+seriesOptions.lineWidth+1,lastY);canvasContext.lineTo(dimensions.width+seriesOptions.lineWidth+1,dimensions.height+seriesOptions.lineWidth+1);canvasContext.lineTo(firstX,dimensions.height+seriesOptions.lineWidth);canvasContext.fillStyle=seriesOptions.fillStyle;canvasContext.fill();}
canvasContext.stroke();canvasContext.closePath();canvasContext.restore();}
if(!options.labels.disabled){canvasContext.fillStyle=options.labels.fillStyle;var maxValueString=parseFloat(maxValue).toFixed(2);var minValueString=parseFloat(minValue).toFixed(2);canvasContext.fillText(maxValueString,dimensions.width-canvasContext.measureText(maxValueString).width-2,10);canvasContext.fillText(minValueString,dimensions.width-canvasContext.measureText(minValueString).width-2,dimensions.height-2);}
canvasContext.restore();};